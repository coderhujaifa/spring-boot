<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>AI Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>

<body class="bg-light">

<nav class="navbar navbar-dark bg-dark px-3">
    <span class="navbar-brand">AI Chat</span>
    <a th:href="@{/logout}" class="btn btn-sm btn-danger">Logout</a>
</nav>

<div class="container mt-4">
    <div id="chatBox" class="p-3 border bg-white rounded shadow-sm" style="height: 70vh; overflow-y: scroll;"></div>

    <form id="chatForm" class="input-group mt-3">
        <input id="msg" class="form-control" placeholder="Type message..." />
        <button class="btn btn-primary">Send</button>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
 async function loadHistory(){
   const res = await axios.get('/api/chat/history');
   const box = document.getElementById('chatBox'); 
   box.innerHTML='';

   res.data.forEach(c => {
     box.innerHTML += `
       <div class='alert alert-primary'>You: ${c.userMessage}</div>
       <div class='alert alert-success'>AI: ${c.aiResponse}</div>
     `;
   });

   box.scrollTop = box.scrollHeight;
 }

 document.getElementById('chatForm').addEventListener('submit', async (e) => {
   e.preventDefault();
   const msg = document.getElementById('msg').value; 
   if(!msg) return;

   await axios.post('/api/chat/send', { message: msg });
   document.getElementById('msg').value = '';
   loadHistory();
 });

 loadHistory();
</script>

</body>
</html>
